generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                    Int       @id @default(autoincrement())
  email                 String    @unique
  password              String
  role                  Role
  passwordResetToken    String?
  passwordResetExpires  DateTime?
  createdAt             DateTime  @default(now())

  admin     Admin?
  company   Company?
  candidate Candidate?
}

enum Role {
  ADMIN
  COMPANY
  CANDIDATE
}

model Admin {
  id      Int    @id @default(autoincrement())
  user    User   @relation(fields: [userId], references: [id])
  userId  Int    @unique
  actions AdminAction[]
}

model Company {
  id        Int      @id @default(autoincrement())
  name      String
  user      User     @relation(fields: [userId], references: [id])
  userId    Int      @unique
  active    Boolean  @default(true)
  styling   Json?
  createdAt DateTime @default(now())

  jobs         Job[]
  actions      CompanyAction[]
  applications Application[]
}

model Job {
  id             Int           @id @default(autoincrement())
  title          String
  description    String
  deadline       DateTime?
  extraQuestions Json?
  createdAt      DateTime      @default(now())
  company        Company       @relation(fields: [companyId], references: [id])
  companyId      Int
  applications   Application[]
}

model Candidate {
  id        Int      @id @default(autoincrement())
  firstName String
  lastName  String
  user      User     @relation(fields: [userId], references: [id])
  userId    Int      @unique
  profile   Json?
  createdAt DateTime @default(now())

  ipLogs       IPLog[]
  applications Application[]
}

model Application {
  id          Int               @id @default(autoincrement())
  candidate   Candidate         @relation(fields: [candidateId], references: [id])
  candidateId Int
  job         Job               @relation(fields: [jobId], references: [id])
  jobId       Int
  company     Company           @relation(fields: [companyId], references: [id])
  companyId   Int
  status      ApplicationStatus @default(PENDING)
  createdAt   DateTime          @default(now())
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model AdminAction {
  id        Int      @id @default(autoincrement())
  admin     Admin    @relation(fields: [adminId], references: [id])
  adminId   Int
  action    String
  details   String?
  createdAt DateTime @default(now())
}

model CompanyAction {
  id        Int      @id @default(autoincrement())
  company   Company  @relation(fields: [companyId], references: [id])
  companyId Int
  action    String
  details   String?
  createdAt DateTime @default(now())
}

model IPLog {
  id          Int       @id @default(autoincrement())
  ip          String
  createdAt   DateTime  @default(now())
  candidate   Candidate? @relation(fields: [candidateId], references: [id])
  candidateId Int?
}
